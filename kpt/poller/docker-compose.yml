services:
  poller:
    build:
      context: .
      dockerfile: Dockerfile.poller
    container_name: kpt-poller
    network_mode: host  # Use host network for DNS resolution
    shm_size: 2gb
    volumes:
      - ./data:/app/data
    tmpfs:
      - /tmp/patchright_kpt:size=100M
    environment:
      - PYTHONUNBUFFERED=1 # real-time log output
      - KPT_POLL_INTERVAL=${KPT_POLL_INTERVAL:-30}
      - KPT_WS_FLUSH_INTERVAL=${KPT_WS_FLUSH_INTERVAL:-5}
      - KPT_HEADLESS=${KPT_HEADLESS:-false}
      - KPT_ENABLE_WEBSOCKET=${KPT_ENABLE_WEBSOCKET:-true}
    restart: unless-stopped
    tty: true
    stdin_open: true
