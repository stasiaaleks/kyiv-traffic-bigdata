# Аналіз транспортного потоку Києва - джерела даних

## Огляд

| Джерело  | Спосіб збору        | Статус    | Що показує                                       |
| -------- | ------------------- | --------- | ------------------------------------------------ |
| **KPT**  | Live (WebSocket)    | Працює    | Позиції громадського транспорту в реальному часі |
| **EWAY** | Live (WebSocket)    | Не працює | Спроба отримати GPS-координати транспорту        |
| **OSM**  | Статичні (REST API) | Працює    | Дорожня мережа, світлофори, переходи             |

---

## KPT (Kyiv Public Transport)

### Деталі

- **Веб-сайт:** <https://kpt.kyiv.ua/online>
- **API маршрутів:** <https://online.kpt.kyiv.ua/api/route/list>
- **WebSocket:** Socket.IO через веб-сторінку

### Спосіб збору

**Live** — в реальному часі через WebSocket.

### Формат

**Приклад повідомлення WebSocket (Socket.IO):**

```
42["vehicles", [{id, routeNumber, lat, lng}, ...]]
```

**Структура об'єкту ТЗ:**

```json
{
  "id": 123,
  "routeNumber": "43",
  "lat": 50.4501,
  "lng": 30.5234
}
```

**Структура об'єкту маршруту:**

```json
{
  "id": 12583001,
  "type": 3,
  "number": "43"
}
```

Типи маршрутів: 1 = трамвай, 2 = тролейбус, 3 = автобус

### Ліміти / Обмеження

- **Cloudflare захист** — зараз є спроба обходу через Selenium з інтерактивним режимом
- **Timeout Cloudflare:** 300 секунд на проходження перевірки
- **Немає офіційного API** — дані отримуються через перехоплення WebSocket

### Приклад використання для аналізу заторів

1. **Швидкість руху транспорту** — порівнюючи послідовні позиції одного транспортного засобу, можна обчислити швидкість руху на ділянках маршруту
2. **Виявлення скупчень** — якщо кілька одиниць транспорту одного маршруту знаходяться близько одна до одної, це може свідчити про затор
3. **Час проходження маршруту** — аналіз відхилень від розкладу теж говорить про проблемні ділянки
4. **Теплова карта затримок** — накладання даних про швидкість на карту для візуалізації проблемних зон

---

## EWAY (EasyWay)

### Посилання

- **Веб-сайт:** <https://www.eway.in.ua>
- **WebSocket:** `wss://ws.easyway.info/sub/gps/{key}`

### Спосіб збору

**Live** — GPS-координати транспорту в реальному часі.

### Формат даних

**Скоріш за все - бінарний протокол з можливими параметрами кодування:**

- Кожна координата: 8 байт (4 байти longitude + 4 байти latitude)
- Формат: little-endian unsigned 32-bit integers
- Масштаб: координати / 100,000,000 = десяткові градуси

### Ліміти / Обмеження

- **Поки немає офіційного API-ключа та швидкої процедури отримання** — запит на отримання ключа залишився без відповіді
- **Бінарний протокол не вдалося повністю декодувати** — можливо, була помилка у декодуванні

### Приклад використання для аналізу заторів

Аналогічно з Київ Пас Транс.

---

## OSM (OpenStreetMap)

### Посилання

- **Overpass API:** <https://overpass-api.de/api/interpreter>
- **Альтернативи:** <https://lz4.overpass-api.de>, <https://z.overpass-api.de>
- **Завантаження:** <https://download.geofabrik.de>

### Спосіб збору

**REST API + polling** — географічні дані про інфраструктуру (оновлюються волонтерами).

### Формат даних

**Вхідний запит (Overpass QL):**

```
[out:json][timeout:90];
(
  node["highway"="traffic_signals"](50.3,30.2,50.6,30.8);
);
out body;
```

**Структура об'єкта відповіді (приклад):**

```json
{
  "elements": [
    {
      "type": "node",
      "id": 12345,
      "lat": 50.45,
      "lon": 30.52,
      "tags": { "highway": "traffic_signals" }
    }
  ]
}
```

**GeoJSON:**

```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": { "type": "Point", "coordinates": [30.52, 50.45] },
      "properties": { "highway": "traffic_signals" }
    }
  ]
}
```

### Доступні категорії даних

| Категорія              | Опис                                                           |
| ---------------------- | -------------------------------------------------------------- |
| Дорожня мережа         | motorway, trunk, primary, secondary, tertiary, residential     |
| Світлофори             | `highway=traffic_signals`                                      |
| Пішохідні переходи     | `highway=crossing`, типи: zebra, traffic_signals, uncontrolled |
| Звуження доріг         | `narrow=yes`, `highway=construction`                           |
| Зони землекористування | residential, industrial, commercial, retail                    |
| Рельєф                 | `incline`, `ele` (висота)                                      |

### Ліміти / Обмеження

**Rate limiting:** ~10,000 запитів/день на IP адресу
**Timeout:** 90 сек
**Рекомендована затримка:** 1.5 секунди між запитами
**Розмір відповіді:** великі запити можуть бути відхилені

```

### Доступні категорії даних

| Категорія | Опис |
|-----------|------|
| Дорожня мережа | motorway, trunk, primary, secondary, tertiary, residential |
| Світлофори | `highway=traffic_signals` |
| Пішохідні переходи | `highway=crossing`, типи: zebra, traffic_signals, uncontrolled |
| Звуження доріг | `narrow=yes`, `highway=construction` |
| Зони землекористування | residential, industrial, commercial, retail |
| Рельєф | `incline`, `ele` (висота) |

### Ліміти / Обмеження

- **Rate limiting:** ~10,000 запитів/день на IP
- **Timeout:** 90 секунд на запит
- **Рекомендована затримка:** 1.5 секунди між запитами
- **Розмір відповіді:** великі запити можуть бути відхилені (потенційна помилка 429)

### Приклад використання для аналізу заторів

1. **Карта світлофорів** — щільність світлофорів на ділянці впливає на пропускну здатність
2. **Аналіз перехресть** — типи перехресть та їх вплив на потік
3. **Виявлення вузьких місць** — звуження доріг, зміна кількості смуг
4. **Кореляція з live-даними** — накладання позицій транспорту на дорожню мережу для точного аналізу швидкості на конкретних ділянках
5. **Пішохідні переходи** — місця, де транспорт сповільнюється для пропуску пішоходів
```
