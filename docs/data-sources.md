# Аналіз транспортного потоку Києва — джерела даних

В цьому репозиторії зібрані способи збору по таких опрацьованих джерелах:
<https://github.com/stasiaaleks/kyiv-traffic-bigdata>

## Огляд статусу

| Джерело           | Метод            | Статус                           | Тип даних                             |
| ----------------- | ---------------- | -------------------------------- | ------------------------------------- |
| **KPT**           | WebSocket + REST | Працює                           | Позиції транспорту в реальному часі   |
| **EWAY**          | WebSocket        | Спроба перехопити, очікуємо ключ | GPS-координати (бінарний протокол)    |
| **OSM**           | REST API         | Працює                           | Дорожня мережа, світлофори, переходи  |
| **OpenMeteo**     | REST API         | Працює                           | Погода, висота над рівнем моря        |
| **Alerts.in.ua**  | REST API         | Очікую ключ                      | Повітряні тривоги                     |
| **Google Routes** | REST API         | Обмежено                         | Маршрутизація (безкоштовно для нових) |

---

## KPT (КиївПасТранс)

Основне джерело даних про громадський транспорт у реальному часі. Створено інтерцептор, який обходить Cloudflare капчу через patchright(<https://roundproxies.com/blog/patchright/>) та отримує координати транспорту через WebSocket + список транспортних засобів через REST API.

**Веб-сайт:** <https://kpt.kyiv.ua/online>
**API маршрутів:** <https://online.kpt.kyiv.ua/api/route/list>

### Пайплайн

1. Patchright розв'язує Cloudflare Turnstile challenge
2. Витягуємо cookie `cf_clearance` для доступу до API
3. Підключаємось до WebSocket через Socket.IO handshake
4. Стрімимо позиції транспорту кожні ~5 секунд
5. Запитуємо список маршрутів через REST API кожні 30 секунд
6. Оновлюємо cookies при їх закінченні (HTTP 403)

### Формат даних

**Позиція транспорту (CSV через WebSocket):**

```
vehicle_id,route_id,lat,lon,direction,flag,timestamp
12585093,12583358,50.50963,30.64338,0,0,1769342268
```

**Типи маршрутів:** 1 = трамвай, 2 = тролейбус, 3 = автобус

### Вихідні файли

- `kpt_positions_YYYYMMDD.jsonl` — позиції транспорту
- `kpt_routes_YYYYMMDD.jsonl` — метадані маршрутів

### Обмеження

- Захист Cloudflare вимагає автоматизації браузера
- Немає офіційної документації API
- Cookie періодично закінчується, потребує оновлення

---

## EWAY (EasyWay)

Була спроба перехопити GPS-дані з WebSocket потоку EasyWay. Сервіс використовує бінарний протокол, який не вдалося повністю декодувати. Також очікуємо на отримання ключів.

**Веб-сайт:** <https://www.eway.in.ua>
**WebSocket:** `wss://ws.easyway.info/sub/gps/{key}`

### Статус: Заблоковано

- Запит на API-ключ надіслано, відповіді не отримано
- Бінарний протокол використовує little-endian 32-bit integers для координат
- Кожна пара координат — 8 байт, масштаб 100,000,000

---

## OSM (OpenStreetMap)

Статичні дані інфраструктури, які оновлюються волонтерами. Корисно для розуміння характеристик доріг.

**Overpass API:** <https://overpass-api.de/api/interpreter>
**Завантаження:** <https://download.geofabrik.de>

### Релевантні теги

| Категорія      | Теги                                              |
| -------------- | ------------------------------------------------- |
| Дорожня мережа | `highway`, `lanes`, `maxspeed`, `oneway`          |
| Світлофори     | `highway=traffic_signals`                         |
| Переходи       | `highway=crossing`, `crossing=zebra/uncontrolled` |
| Вузькі місця   | `narrow=yes`, `highway=construction`              |
| Рельєф         | `incline`, `ele`                                  |

### Ліміти

- ~10,000 запитів/день на IP
- Таймаут 90 секунд
- Рекомендована пауза 1-2 секунди між запитами

---

## OpenMeteo (Погода)

Безкоштовний API погоди з історичними даними

**API:** <https://open-meteo.com/en/docs/historical-weather-api>

### Особливості

- Не потребує API-ключа
- Містить дані про висоту (можна корелювати з OSM)
- Історичні дані погоди за будь-який період

---

## Alerts.in.ua (Повітряні тривоги)

**Форма запиту API:** <https://alerts.in.ua/api-request>

### Статус: Очікує

Запит на API-ключ надіслано, очікуємо відповідь.

---

## Google Routes API

Комерційний API маршрутизації з урахуванням трафіку.

**Ендпоінт:** `https://routes.googleapis.com/directions/v2:computeRoutes`

### Статус: Обмежено

Безкоштовний рівень доступний лише для нових акаунтів Google Cloud з обмеженою квотою запитів (мій акаунт не підходить під цей критерій)
